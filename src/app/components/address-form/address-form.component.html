<div class="form-header">
  <h4 class="text-2xl font-medium mb-2 text-gray-800">
    {{ config.title }}
  </h4>

  <h2 class="text-lg font-medium mb-2 text-gray-700">
    {{
      formGroup.get("addressMode")?.value === "existing"
        ? config.editSubtitle
        : config.newAddressSubtitle
    }}
  </h2>
  <mat-divider class="my-4"></mat-divider>
  <form [formGroup]="formGroup" class="w-full">
    <table class="w-full mt-2">
      @for (field of config.fields; track field.name) {
      <tr class="align-top">
        <td class="py-2">
          @switch (field.type) {

          <!-- Textfeld -->
          @case ('text') {
          <mat-form-field class="w-full">
            <mat-label>{{ field.label }}</mat-label>
            <input
              matInput
              [formControlName]="field.name"
              [required]="field.required"
            />
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültigen Wert eingeben!</mat-error>
            } @if (field.tooltip) {
            <!-- Help-Icon mit Tooltip im Suffix -->
            <button
              mat-icon-button
              matSuffix
              matTooltip="{{ field.tooltip }}"
              matTooltipPosition="above"
              type="button"
              aria-label="Mehr Informationen"
              class="tooltip-icon"
            >
              <mat-icon>help_outline</mat-icon>
            </button>
            }
          </mat-form-field>
          }

          <!-- Select -->
          @case ('select') {
          <mat-form-field class="w-full">
            <mat-select [formControlName]="field.name">
              @for (opt of field.options ?? []; track opt.value) {
              <mat-option [value]="opt.value">{{ opt.label }}</mat-option>
              }
            </mat-select>
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültigen Wert auswählen!</mat-error>
            } @if (field.tooltip) {
            <!-- Help-Icon mit Tooltip im Suffix -->
            <button
              mat-icon-button
              matSuffix
              matTooltip="{{ field.tooltip }}"
              matTooltipPosition="above"
              type="button"
              aria-label="Mehr Informationen"
              class="tooltip-icon"
            >
              <mat-icon>help_outline</mat-icon>
            </button>
            }
          </mat-form-field>
          }

          <!-- Radio -->
          @case ('radio') {
          <div class="w-full">
            <mat-radio-group [formControlName]="field.name" class="radio-group">
              @for (opt of field.options ?? []; track opt.value) {
              <mat-radio-button [value]="opt.value">{{
                opt.label
              }}</mat-radio-button>
              }
            </mat-radio-group>
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültige Auswahl treffen!</mat-error>
            } @if (field.tooltip) {
            <!-- Help-Icon mit Tooltip im Suffix -->
            <button
              mat-icon-button
              matSuffix
              matTooltip="{{ field.tooltip }}"
              matTooltipPosition="above"
              type="button"
              aria-label="Mehr Informationen"
              class="tooltip-icon"
            >
              <mat-icon>help_outline</mat-icon>
            </button>
            }
          </div>
          }

          <!-- Checkbox -->
          @case ('checkbox') {
          <div class="w-full">
            <mat-checkbox [formControlName]="field.name"></mat-checkbox>
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültige Auswahl treffen!</mat-error>
            }
          </div>
          }

          <!-- Number -->
          @case ('number') {
          <mat-form-field class="w-full">
            <mat-label>{{ field.label }}</mat-label>
            <input
              matInput
              [formControlName]="field.name"
              [required]="field.required"
              type="number"
            />
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültigen Wert eingeben!</mat-error>
            } @if (field.tooltip) {
            <!-- Help-Icon mit Tooltip im Suffix -->
            <button
              mat-icon-button
              matSuffix
              matTooltip="{{ field.tooltip }}"
              matTooltipPosition="above"
              type="button"
              aria-label="Mehr Informationen"
              class="tooltip-icon"
            >
              <mat-icon>help_outline</mat-icon>
            </button>
            }
          </mat-form-field>
          }

          <!-- Date -->
          @case ('date') {
          <mat-form-field class="w-full">
            <mat-label>{{ field.label }}</mat-label>
            <input
              matInput
              [formControlName]="field.name"
              [required]="field.required"
              type="date"
            />
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültigen Wert eingeben!</mat-error>
            } @if (field.tooltip) {
            <!-- Help-Icon mit Tooltip im Suffix -->
            <button
              mat-icon-button
              matSuffix
              matTooltip="{{ field.tooltip }}"
              matTooltipPosition="above"
              type="button"
              aria-label="Mehr Informationen"
              class="tooltip-icon"
            >
              <mat-icon>help_outline</mat-icon>
            </button>
            }
          </mat-form-field>
          }

          <!-- Email -->
          @case ('email') {
          <mat-form-field class="w-full">
            <mat-label>{{ field.label }}</mat-label>
            <input
              matInput
              [formControlName]="field.name"
              [required]="field.required"
              type="email"
            />
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültigen Wert eingeben!</mat-error>
            }
          </mat-form-field>
          } @case ('tel') {
          <mat-form-field class="w-full">
            <mat-label>{{ field.label }}</mat-label>
            <input
              matInput
              [formControlName]="field.name"
              [required]="field.required"
              type="tel"
            />
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültigen Wert eingeben!</mat-error>
            } @if (field.tooltip) {
            <!-- Help-Icon mit Tooltip im Suffix -->
            <button
              mat-icon-button
              matSuffix
              matTooltip="{{ field.tooltip }}"
              matTooltipPosition="above"
              type="button"
              aria-label="Mehr Informationen"
              class="tooltip-icon"
            >
              <mat-icon>help_outline</mat-icon>
            </button>
            }
          </mat-form-field>
          } @case ('table') { @if (formGroup.get('addressMode')?.value ===
          'existing') {
          <p class="mb-2 text-lg text-gray-600">
            Bitte wählen Sie eine Adresse aus der Tabelle aus. Überprüfen sie
            die Auswahl in den Eingabefeldern unterhalb.
          </p>
          <app-generic-table
            [dataSource]="tableDataSource"
            [columns]="tableColumns"
            [pageSize]="5"
            (rowClicked)="onRowClickedPatchForm($event)"
          ></app-generic-table>
          <mat-divider></mat-divider>
          } }
          <!-- Textarea -->
          @case ('textarea') {
          <mat-form-field class="w-full">
            <mat-label>{{ field.label }}</mat-label>
            <textarea
              matInput
              [formControlName]="field.name"
              [required]="field.required"
            ></textarea>
            @if (formGroup.get(field.name)?.invalid &&
            formGroup.get(field.name)?.touched) {
            <mat-error>Bitte gültigen Wert eingeben!</mat-error>
            } @if (field.tooltip) {
            <!-- Help-Icon mit Tooltip im Suffix -->
            <button
              mat-icon-button
              matSuffix
              matTooltip="{{ field.tooltip }}"
              matTooltipPosition="above"
              type="button"
              aria-label="Mehr Informationen"
              class="tooltip-icon"
            >
              <mat-icon style="color: rgb(58, 126, 229)">help</mat-icon>
            </button>
            }
          </mat-form-field>
          } }
        </td>
      </tr>
      }
    </table>
  </form>
</div>
