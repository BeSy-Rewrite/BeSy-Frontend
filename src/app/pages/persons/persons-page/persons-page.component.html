<mat-tab-group #tabGroup mat-stretch-tabs="true" mat-align-tabs="start">
  <mat-tab label="Personen verwalten">
    <mat-divider class="bg-gray-500"></mat-divider>
    <div class="pt-3">
      <app-generic-table
        [dataSource]="personsDataSource"
        [columns]="personsTableColumns"
        [actions]="actions"
        [pageSize]="50"></app-generic-table>
    </div>
  </mat-tab>

  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="mr-2">add_circle</mat-icon>
      <span>Neue Person anlegen</span>
    </ng-template>

    <mat-divider class="bg-gray-500"></mat-divider>

    <div class="create-person-container">
      <!-- Step 1: Person Data -->
      <div class="step-section">
        <div class="step-header">
          <div class="step-indicator">1</div>
          <div class="step-title">
            <h2>Personendaten eingeben</h2>
            <span class="required-badge">Erforderlich</span>
            <p class="step-subtitle">Pflichtfelder sind mit * gekennzeichnet</p>
          </div>
        </div>
        <div class="step-content">
          <app-form-component
            [config]="personsFormConfig"
            [formGroup]="personFormGroup"></app-form-component>
        </div>
      </div>

      <!-- Step 2: Address (Optional) -->
      <div class="step-section">
        <div class="step-header">
          <div class="step-indicator">2</div>
          <div class="step-title">
            <h2>Bevorzugte Adresse festlegen</h2>
            <span class="optional-badge">Optional</span>
          </div>
        </div>
        <div class="step-content">
          <!-- Address Mode Selection -->
          <div class="address-mode-selector">
            <mat-button-toggle-group
              [value]="addressSelectionMode()"
              (change)="onAddressModeChange($event)"
              class="address-toggle-group">
              <mat-button-toggle value="existing">
                <mat-icon>search</mat-icon>
                <span>Vorhandene Adresse ausw채hlen</span>
              </mat-button-toggle>
              <mat-button-toggle value="new">
                <mat-icon>add</mat-icon>
                <span>Neue Adresse anlegen</span>
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>

          <!-- Existing Address Selection -->
          @if (addressSelectionMode() === 'existing') {
          <div class="address-selection-panel">
            <div class="info-banner">
              <mat-icon>info</mat-icon>
              <span>Klicken Sie auf eine Zeile, um die Adresse auszuw채hlen. Die Details werden unten
                angezeigt.</span>
            </div>
            <app-generic-table
              [dataSource]="addressTableDataSource"
              [columns]="addressTableColumns"
              [pageSize]="5"
              (rowClicked)="onAddressInTableSelected($event)"></app-generic-table>

            @if (selectedAddressId) {
            <div class="selected-address-preview">
              <div class="preview-header">
                <mat-icon>check_circle</mat-icon>
                <span>Ausgew채hlte Adresse (ID: {{ selectedAddressId }})</span>
              </div>
              <app-form-component
                [config]="addressFormConfig"
                [formGroup]="addressFormGroup"></app-form-component>
            </div>
            }
          </div>
          }

          <!-- New Address Form -->
          @if (addressSelectionMode() === 'new') {
          <div class="new-address-panel">
            <div class="info-banner info-banner--action">
              <mat-icon>edit</mat-icon>
              <span>Geben Sie die Daten f체r die neue Adresse ein.</span>
            </div>
            <app-form-component
              [config]="addressFormConfig"
              [formGroup]="addressFormGroup"></app-form-component>
          </div>
          }
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-bar w-full flex justify-between mt-6">
        <button mat-raised-button color="warn" (click)="onBack()" class="action-button">
          <mat-icon>close</mat-icon>
          Verwerfen
        </button>
        <button
          mat-raised-button
          color="primary"
          (click)="onSubmit()"
          class="action-button action-button--primary">
          <mat-icon>save</mat-icon>
          Person speichern
        </button>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
