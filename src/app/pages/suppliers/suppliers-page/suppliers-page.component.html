<div class="h-screen">
  <mat-tab-group #tabGroup mat-stretch-tabs="true" mat-align-tabs="start">
    <mat-tab label="Lieferanten verwalten">
      <mat-divider style="background-color: darkgrey"></mat-divider>
      <div class="pt-3">
        <app-generic-table
          [dataSource]="suppliersDataSource"
          [columns]="suppliersTableColumns"
          [actions]="actions"
          [pageSize]="50"
        ></app-generic-table>
      </div>
    </mat-tab>

    <mat-tab label="Neuen Lieferanten anlegen">
      <mat-divider style="background-color: darkgrey"></mat-divider>

      <div class="create-supplier-container">
        <!-- Step 1: Supplier Data -->
        <div class="step-section">
          <div class="step-header">
            <div class="step-indicator">1</div>
            <div class="step-title">
              <h2>Lieferantendaten eingeben</h2>
              <p class="step-subtitle">Pflichtfelder sind mit * gekennzeichnet</p>
            </div>
          </div>
          <div class="step-content">
            <app-form-component
              [config]="supplierFormConfig"
              [formGroup]="supplierFormGroup"
            ></app-form-component>
          </div>
        </div>

        <!-- Step 2: Customer ID (Optional) -->
        <div class="step-section">
          <div class="step-header">
            <div class="step-indicator">2</div>
            <div class="step-title">
              <h2>Kundennummer hinzufügen</h2>
              <span class="optional-badge">Optional</span>
            </div>
          </div>
          <div class="step-content">
            <div class="info-banner info-banner--info">
              <mat-icon>lightbulb</mat-icon>
              <span
                >Falls Sie bereits eine Kundennummer bei diesem Lieferanten haben, können Sie diese
                hier hinterlegen.</span
              >
            </div>
            <app-form-component
              [config]="customerIdFormConfig"
              [formGroup]="customerIdForm"
            ></app-form-component>
          </div>
          <button
            mat-raised-button
            color="primary"
            class="customer-id-add-button"
            (click)="onAddCustomerID()"
            [disabled]="customerIdForm.invalid"
          >
            <mat-icon>add</mat-icon>
            Kundennummer hinzufügen
          </button>
          <div class="added-customer-id-preview">
            @if (customerIDs().length > 0) {
              <div class="customer-id-table-container mt-6">
                <div class="customer-id-table-header">
                  <mat-icon>list_alt</mat-icon>
                  <span>Hinzugefügte Kundennummer(n)</span>
                </div>
                <app-generic-table
                  [dataSource]="customerIDsTableDataSource"
                  [columns]="customerIDsTableColumns"
                  [pageSize]="5"
                ></app-generic-table>
              </div>
            }
          </div>
        </div>

        <!-- Step 3: Address (Required) -->
        <div class="step-section">
          <div class="step-header">
            <div class="step-indicator">3</div>
            <div class="step-title">
              <h2>Adresse des Lieferanten festlegen</h2>
              <span class="required-badge">Erforderlich</span>
            </div>
          </div>
          <div class="step-content">
            <!-- Address Mode Selection -->
            <div class="address-mode-selector">
              <mat-button-toggle-group
                [value]="addressMode()"
                (change)="onAddressModeChange($event)"
                class="address-toggle-group"
              >
                <mat-button-toggle value="search">
                  <mat-icon>search</mat-icon>
                  <span>Adresse suchen</span>
                </mat-button-toggle>
                <mat-button-toggle value="new">
                  <mat-icon>add</mat-icon>
                  <span>Neue Adresse anlegen</span>
                </mat-button-toggle>
              </mat-button-toggle-group>
            </div>

            <!-- Search Address Mode -->
            @if (addressMode() === 'search') {
              <div class="address-search-panel">
                <div class="info-banner">
                  <mat-icon>info</mat-icon>
                  <span
                    >Geben Sie den Firmennamen oder Standort ein, um Adressen zu suchen. Wählen Sie
                    dann eine Adresse aus der Tabelle.</span
                  >
                </div>

                <div class="search-input-container">
                  <app-form-component
                    [config]="nominatimAddressFormConfig"
                    [formGroup]="nominatimAddressFormGroup"
                    (searchEvent)="onSearch($event)"
                  ></app-form-component>
                </div>

                @if (nominatimTableDataSource().data.length > 0) {
                  <div class="search-results-container">
                    <app-generic-table
                      [dataSource]="nominatimTableDataSource()"
                      [columns]="nominatimResponseTableColumns"
                      [pageSize]="5"
                      (rowClicked)="onAddressInTableSelected($event)"
                    ></app-generic-table>
                  </div>
                }

                @if (addressIsSelected()) {
                  <div class="selected-address-preview">
                    <div class="preview-header">
                      <mat-icon>edit_location</mat-icon>
                      <span>Ausgewählte Adresse - Bitte überprüfen und ggf. ergänzen</span>
                    </div>
                    <div class="preview-warning">
                      <mat-icon>warning</mat-icon>
                      <span
                        >Suchergebnisse können unvollständig sein. Bitte überprüfen und ergänzen Sie
                        die Adressdaten.</span
                      >
                    </div>
                    <app-form-component
                      [config]="addressFormConfig"
                      [formGroup]="addressFormGroup"
                    ></app-form-component>
                  </div>
                }
              </div>
            }

            <!-- New Address Mode -->
            @if (addressMode() === 'new') {
              <div class="new-address-panel">
                <div class="info-banner info-banner--action">
                  <mat-icon>edit</mat-icon>
                  <span>Geben Sie die vollständige Adresse des Lieferanten ein.</span>
                </div>
                <app-form-component
                  [config]="addressFormConfig"
                  [formGroup]="addressFormGroup"
                ></app-form-component>
              </div>
            }
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-bar w-full flex justify-between mt-6">
          <button mat-raised-button color="warn" (click)="onBack()" class="action-button">
            <mat-icon>close</mat-icon>
            Verwerfen
          </button>
          <button
            mat-raised-button
            color="primary"
            (click)="onSubmit()"
            class="action-button action-button--primary"
          >
            <mat-icon>save</mat-icon>
            Lieferant speichern
          </button>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
